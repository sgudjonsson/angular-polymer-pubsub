<!DOCTYPE html>
<html ng-app="app">
    <head>
        <title>Angular + Polymer + PubSub</title>
        <meta charset="utf-8" />

        <link href="/vendors/semantic-ui/build/packaged/css/semantic.min.css" rel="stylesheet" type="text/css" />
        <link href="http://fonts.googleapis.com/css?family=Open+Sans:400,700" rel="stylesheet" type="text/css" />
        <link href="/css/common.css" rel="stylesheet" type="text/css" />
        
        <!-- Third party libraries -->
        <script src="/vendors/angular/angular.min.js"></script>
        <script src="/vendors/platform/platform.js"></script>
        <script src="/vendors/pubsub-js/src/pubsub.js"></script>
        <script src="/vendors/lodash/dist/lodash.min.js"></script>

        <script src="/globals/publisher.js"></script>

        <!-- Angular app -->
        <script src="/app/main.js"></script>

        <!-- Polymer components -->
        <link href="/components/login.html" rel="import" />
        <link href="/components/link.html" rel="import" />

    </head>
    <body ng-controller="AppController">
        <div class="ui grid">
            <div class="column">
                <div class="ui form segment">
                    <h3>Angular says...
                        <a class="ui green label" ng-show="isAuthenticated" ng-click="toggleAuthenticated()">User is authenticated</a>
                        <a class="ui black label" ng-show="!isAuthenticated" ng-click="toggleAuthenticated()">User is not authenticated</a>
                    </h3>
                    <div class="field">
                        <label for="foo">Username</label>
                        <input type="text" name="foo" id="foo" ng-model="username" />
                    </div>
                </div>
                <x-login username="{{username}}" password="{{password}}" motherfucker="{{motherfucker}}"></x-login>
                <x-link href="/api" text="Click me!"></x-link>
                <div class="ui form segment">
                    <h3>The page says ...</h3>
                    <pre id="log"></pre>
                    <script>


                    var self = this;
                    var login = document.querySelector('x-login');
                    login.addEventListener('login', function(e) {
                        angular.element(this).scope().doLogin(e.detail.username, e.detail.password);

                        var a = login.dispatchEvent(new CustomEvent("fuuu", { detail: { ble: 1 }}));
                        console.log("fuuu returned", a);
                    });


                        PubSub.subscribe('user-authenticated', function(msg, data) {
                            var log = document.querySelector("#log");
                            log.innerHTML = log.innerHTML + "\r\nisAuthenticated = "+ data.isAuthenticated;
                        });

                        function BindToElement(o) {
                            console.log(angular.element(document.querySelector("body")).scope());
                            var login = document.querySelector('x-login');
                            login.motherfucker = o;
                        }

                    </script>
                </div>
            </div>
        </div>
    </body>
</html>